
VER=correct_output_1.6

BYTECODE_LIBDIR=..

include $(BYTECODE_LIBDIR)/make.def

LIB=-lbytecode
JAVAP=javap -c

CFLAGS=-g -I$(BYTECODE_LIBDIR) -L$(BYTECODE_LIBDIR)
LDFLAGS=-lbytecode

PURECOV=purecov

.c:
	$(PURIFY) $(CC) $(CFLAGS) $@.c $(LDFLAGS) -o $@

default:
	@echo ""
	@echo "This testing code compares results generated by javap,"
	@echo "so it can fail if the version you have installed differs"
	@echo "from the one that was used to generate the output here."
	@echo ""

1.6:
	$(MAKE) VER=correct_output_1.6 test

1.5:
	$(MAKE) VER=correct_output_1.5 test

1.3:
	$(MAKE) VER=correct_output_1.3 test

code:
	@for testcase in $(VER)/*.correct ; do \
		$(MAKE) PURIFY=$(PURIFY) `basename $$testcase | sed s/\.correct//` ; \
	done

test: code
	@for testcase in $(VER)/*.correct ; do \
		tc=`basename $$testcase | sed s/\.correct//` ; \
		if ./runtest $$tc $$testcase > /dev/null 2>&1 ; then \
			echo "$$tc 		OK"; \
		else \
			echo "$$tc 		Failed"; \
		fi ;\
	done

coverage_test: coverage_test.c
	$(PURECOV) $(CC) $(CFLAGS) coverage_test.c $(LDFLAGS) -o coverage_test

clean:
	/bin/rm -f *.o *.f2j *.class *.pcv coverage_test
	/bin/rm -rf coverage
	@for testcase in $(VER)/*.correct ; do \
		/bin/rm -f `basename $$testcase | sed s/\.correct//` ; \
	done
