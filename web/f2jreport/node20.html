<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!--Converted with LaTeX2HTML 96.1 (Feb 5, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>Type Analysis</TITLE>
<META NAME="description" CONTENT="Type Analysis">
<META NAME="keywords" CONTENT="f2jreport">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="f2jreport.css">
</HEAD>
<BODY LANG="EN">
 <A NAME="tex2html293" HREF="node21.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="http://www.cs.utk.edu/~icl/WebSite/icons/next_motif.gif"></A> <A NAME="tex2html291" HREF="node3.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="http://www.cs.utk.edu/~icl/WebSite/icons/up_motif.gif"></A> <A NAME="tex2html285" HREF="node19.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="http://www.cs.utk.edu/~icl/WebSite/icons/previous_motif.gif"></A>   <BR>
<B> Next:</B> <A NAME="tex2html294" HREF="node21.html">Functions as Arguments</A>
<B>Up:</B> <A NAME="tex2html292" HREF="node3.html">Translating LAPACK FORTRAN to </A>
<B> Previous:</B> <A NAME="tex2html286" HREF="node19.html">Passing array elements by </A>
<BR> <P>
<H3><A NAME="SECTION000211700000000000000">Type Analysis</A></H3>
<P>
Section <A HREF="node18.html#obj_wrapper">2.1.15</A> mentioned the need for type analysis
in f2j by giving two examples of F<font size=-1><small>ORTRAN</small></font> code that would 
not translate correctly otherwise.  However, f2j does not
implement typechecking, <EM>per se</EM>.  That is, not in the
traditional sense of the word.  It does not attempt to
warn the user of any type mismatches or other semantic
errors.  What f2j really does is fully traverse the AST and assign type
information to every node, which is then used during code
generation.  This usually requires 
propagating type information from child nodes back up the
tree to the parent nodes.  Once the type assignment pass
has completed, the code generator can use this information
to compare arguments/parameters and generate the 
correct function calls.  In order for the code generator to
compare the actual arguments in a function call to the
parameters expected by the function, the function must be
parsed and analyzed by f2j.  This means that to generate
correct Java code, it is sometimes necessary to append
external functions and subroutines to the F<font size=-1><small>ORTRAN</small></font> program
that f2j is translating.  This is because the function/subroutine
declaration needs to be parsed and stored in a hash table.
If f2j needs to generate a function call, but cannot find
the parameter information in the hash table, it will ``guess''
about the expected data types.  That is the reason we say that 
it is ``sometimes'' necessary to append the function - because
sometimes f2j will guess correctly and other times it will
not.  To eliminate the need for appending all the functions
into one file, we may extend the f2j parser to deal with multiple
files provided on the command line.
<P>
Parameter passing is not the only situation in which we might
need to use information gained during the type analysis phase.
Consider the following segment of code from dlamch.f:
<PRE>      INTEGER            LBETA, LT
      DOUBLE PRECISION   A, B, C, F, ONE, QTR, SAVEC, T1, T2
*
      [...]
*
      LBETA = C + QTR
*
      [...]</PRE>
<P>
Java does not allow assigning a double precision value to an
integer variable without an explicit cast.  Consequently, when
f2j generates an assignment statement, it needs to determine
the data type of the right hand side expression and the data
type of the left hand side variable.  If the data types differ,
f2j must generate an explicit cast, as follows:
<PRE>int lbeta;
double c, qtr;
[...]
lbeta = (int) (c+qtr);
[...]</PRE>
<HR><A NAME="tex2html293" HREF="node21.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="http://www.cs.utk.edu/~icl/WebSite/icons/next_motif.gif"></A> <A NAME="tex2html291" HREF="node3.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="http://www.cs.utk.edu/~icl/WebSite/icons/up_motif.gif"></A> <A NAME="tex2html285" HREF="node19.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="http://www.cs.utk.edu/~icl/WebSite/icons/previous_motif.gif"></A>   <BR>
<B> Next:</B> <A NAME="tex2html294" HREF="node21.html">Functions as Arguments</A>
<B>Up:</B> <A NAME="tex2html292" HREF="node3.html">Translating LAPACK FORTRAN to </A>
<B> Previous:</B> <A NAME="tex2html286" HREF="node19.html">Passing array elements by </A>
<P><ADDRESS>
<I>Keith Seymour <BR>
Wed Jun 10 19:38:14 EDT 1998</I>
</ADDRESS>
</BODY>
</HTML>
